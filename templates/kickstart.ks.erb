install
text
poweroff

lang en_US.utf8
keyboard de
timezone --utc Europe/Berlin

<% if @networkconfig['type'] == "dhcp" %>
network --bootproto=dhcp
<% else %>
network --bootproto=static --hostname=basisimage.local --device=<%= @networkconfig['device'] %> --ip=<%= @networkconfig['ip'] %> --gateway=<%= @networkconfig['gateway'] %> --netmask=<%= @networkconfig['netmask'] %> --nameserver=<%= @networkconfig['nameserver'] %>
<% end %>

authconfig  --enableshadow --passalgo=sha512
rootpw      --iscrypted <%= @rootpw %>

firstboot --disable
firewall  --disabled
selinux   --disabled
services  --disabled iscsi,iscsid,bluetooth,pcscd,microcode_ctl,cpuspeed,mdmonitor,lvm2-monitor,yum-updatesd,haldaemon,messagebus,smartd,xfs,readahead_early,readahead_later,netfs,nfslock,rpcgssd,rpcidmapd,portmap,mcstrans,kudzu,anacron,hidd,rawdevices,firstboot,atd

bootloader  --driveorder=vda --location=mbr --append="clocksource_failover=acpi_pm"
zerombr
clearpart   --all

part /      --fstype=ext3 --size=<%= @partitions['root'] %>
part /var   --fstype=ext3 --size=<%= @partitions['var'] %>
part swap   --fstype=swap --size=<%= @partitions['swap'] %>

repo --name="puppet"  --baseurl=<%= @yum_repo_puppet %>
repo --name="context" --baseurl=<%= @ohd_repo_puppet %>

%packages --nobase --ignoremissing
@core
puppet
ntp
ntpdate
opennebula-context

%post --log=/root/post-install.log
rm -v /etc/yum.repos.d/CentOS-*
